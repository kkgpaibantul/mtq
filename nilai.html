<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cek Nilai - MTQ Bantul 2025</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- Variabel Warna (Emerald Klasik & Emas Hangat) --- */
        :root {
            --primary-green: #004d40;     /* Emerald Tua (Dasar) */
            --secondary-green: #00695c;   /* Emerald Sedang (Kontras) */
            --accent-gold: #d4a574;       /* Emas Hangat (Aksen Utama) */
            --light-gold: #e6c9a8;        /* Emas Sangat Terang */
            --light-cream: #f5f5f5;       /* Off-White (Latar Belakang Body/Info) */
            --pure-white: #ffffff;
            --text-main: #212121;         /* Teks Utama Hitam */
            --text-subtle: #616161;       /* Teks Sekunder Abu-abu */
            --border-light: #e0e0e0;      /* Border Halus */
            --shadow-soft: rgba(0, 0, 0, 0.1);
            --success-green: #2ecc71;     /* Hijau untuk Status Lolos */
            --warning-orange: #e67e22;    /* Oranye untuk Peringatan */
        }

        /* --- Global & Base Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--light-cream);
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* --- NAVBAR & HEADER --- */
        .mtq-navbar {
            background: var(--primary-green);
            padding: 15px 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 3px solid var(--accent-gold);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .navbar-logo { color: var(--light-gold); font-weight: 700; font-size: 1.5rem; text-decoration: none; display: flex; align-items: center; gap: 12px;}
        .navbar-logo img { height: 40px; border-radius: 6px; }

        .navbar-menu { display: flex; list-style: none; gap: 10px; }
        .nav-link { padding: 10px 18px; color: var(--pure-white); text-decoration: none; border-radius: 8px; transition: all 0.3s ease; font-weight: 500; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;}
        .nav-link:hover { background: rgba(212, 165, 116, 0.2); color: var(--accent-gold); }
        .navbar-mobile-toggle { display: none; background: none; border: none; color: var(--pure-white); font-size: 1.6rem; cursor: pointer; padding: 8px; border-radius: 6px; }

        .container {
            max-width: 1000px;
            margin: 30px auto;
            background: var(--pure-white);
            border-radius: 12px;
            box-shadow: 0 15px 45px var(--shadow-soft);
            overflow: hidden;
            border: 1px solid var(--border-light);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 { color: var(--light-gold); font-size: 2.5em; margin-bottom: 8px; font-weight: 700; letter-spacing: 1px; }
        .header p { opacity: 0.9; font-size: 1.1em; font-weight: 400; color: var(--light-cream); }

        /* --- SEARCH SECTION & INPUTS --- */
        .search-section { padding: 30px; background: var(--light-cream); border-bottom: 1px solid var(--border-light); }
        .input-group { display: flex; gap: 15px; margin-bottom: 20px; }
        .input-group input { flex: 1; padding: 16px; border: 1px solid var(--border-light); border-radius: 8px; font-size: 16px; background: var(--pure-white); color: var(--text-main); }
        .input-group input:focus { outline: none; border-color: var(--accent-gold); box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.3); }
        .input-group button { padding: 16px 30px; background: var(--accent-gold); color: var(--primary-green); border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; transition: all 0.3s;}
        .input-group button:hover { background: #e3b782; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .examples { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; justify-content: center; }
        .example-chip { background: var(--pure-white); border: 1px solid var(--accent-gold); color: var(--secondary-green); padding: 8px 18px; border-radius: 20px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s; }
        .example-chip:hover { background: var(--accent-gold); color: var(--pure-white); }
        
        /* --- SECTIONS COMMON --- */
        .section { padding: 30px; border-bottom: 1px solid var(--border-light); }
        .section:last-child { border-bottom: none; }
        
        .section-title {
            color: var(--primary-green);
            margin-bottom: 25px;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid var(--accent-gold);
            padding-left: 15px;
            text-transform: uppercase;
        }
        .section-title i { color: var(--accent-gold); }

        /* --- INFORMASI TABLE STYLES (PESERTA/TIM) --- */
        .info-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 5px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
        }

        .info-table tr {
            background: var(--light-cream);
            transition: background 0.3s;
        }

        .info-table tr:hover {
            background: #ebebeb; 
        }

        .info-table td {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
        }

        .info-table tr:last-child td {
            border-bottom: none;
        }

        .info-label-cell {
            font-weight: 500;
            color: var(--text-subtle);
            font-size: 0.95em;
            text-transform: uppercase;
            width: 180px; 
            background: #e9e9e9; 
            border-right: 1px solid var(--border-light);
            text-align: left; 
        }

        .info-label-cell::after {
            content: ""; 
            color: var(--text-subtle);
        }

        .info-value-cell {
            color: var(--text-main);
            font-size: 1.1em;
            font-weight: 600;
            text-align: left; /* INFORMASI PESERTA/TIM: RATA KIRI */
        }

        /* --- LIST SKOR (Babak Penyisihan & Final) --- */
        .scores-list { 
            display: flex; 
            flex-direction: column; 
            gap: 0; 
        }
        
        .score-item {
            display: flex; 
            justify-content: space-between; /* Paksa label ke kiri, nilai ke kanan */
            align-items: baseline;
            width: 100%;
            padding: 15px 0;
            border-bottom: 1px dashed var(--border-light);
            font-size: 1.1em;
        }
        
        .score-item:last-child { border-bottom: none; }

        .score-aspek {
            color: var(--text-subtle);
            font-weight: 500;
            text-transform: capitalize; 
            width: 200px; 
            flex-shrink: 0;
            display: block;
            text-align: left; 
            padding-right: 10px; 
        }
        
        .score-aspek::after { 
            content: ""; 
            padding-left: 5px; 
            color: var(--text-subtle); 
        } 

        .score-nilai {
            font-weight: 600;
            color: var(--text-main);
            font-size: 1em; 
            flex-grow: 0; 
            padding-left: 0;
            text-align: right; /* SKOR BABAK: RATA KANAN */
        }

        .score-nilai.highlight { color: var(--accent-gold); font-weight: 700; }
        
        /* --- DESAIN TABEL SKOR (DETAIL PENILAIAN) --- */
        .table-responsive { overflow-x: auto; margin-bottom: 20px; }
        .score-table {
            border-collapse: separate; 
            border-spacing: 0;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            width: 100%; 
            min-width: 500px; 
        }

        .score-table th { 
            background: var(--secondary-green); 
            color: var(--light-gold); 
            padding: 16px 12px; 
            font-weight: 700; 
            letter-spacing: 0.5px; 
            text-align: center; 
        }
        
        .score-table th:first-child {
             text-align: center; /* Header KRITERIA rata tengah */
        }

        .score-table td { padding: 14px 12px; border-bottom: 1px solid var(--border-light); text-align: center; }
        .score-table tr:nth-child(even) { background: var(--light-cream); }
        
        .criteria-col { 
            font-weight: 600; 
            color: var(--primary-green); 
            text-align: left; /* Isi Kriteria A, B, C rata kiri */
            padding-left: 20px !important; 
        }
        
        /* Penyesuaian untuk baris total agar label JUMLAH rata tengah */
        .total-row .criteria-col {
            text-align: center !important; /* Label JUMLAH rata tengah */
        }

        .juri-col { 
            font-weight: 500; 
            color: var(--text-main); 
            text-align: center; /* Nilai Juri tetap tengah */
        }

        .total-row { 
            background: #e6f7f5; 
            color: var(--primary-green); 
            font-size: 1em; 
            border-top: 2px solid var(--border-light); 
        }
        
        .total-row td {
            text-align: center !important; 
        }
        
        .final-row { background: var(--accent-gold); color: var(--primary-green); }
        .final-row .criteria-col, .final-row .juri-col { 
            text-align: center !important; 
        }

        /* --- Loading, Status, Action Buttons, Footer (Minimal Changes) --- */
        .loading { text-align: center; padding: 50px; color: var(--secondary-green); font-size: 1.1em; }
        .loading-spinner { border: 4px solid var(--border-light); border-top: 4px solid var(--accent-gold); border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .status-lolos { background: #e6f7ef; color: var(--success-green); border-left: 5px solid var(--success-green); padding: 18px; border-radius: 8px; font-weight: 600; margin: 20px 0; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .status-tidak-lolos { background: #fdf6ec; color: var(--warning-orange); border-left: 5px solid var(--warning-orange); padding: 18px; border-radius: 8px; font-weight: 600; margin: 20px 0; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .juara-badge { background: linear-gradient(145deg, #FFD700, #E6A82E); color: #5d4a1f; padding: 15px 25px; border-radius: 10px; font-weight: 700; margin: 20px auto; border: 1px solid #FFC107; font-size: 1.3em; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); max-width: fit-content; }
        
        .action-buttons { display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap; padding: 0 30px 30px; }
        .action-btn { padding: 15px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; gap: 10px; flex: 1; min-width: 160px; justify-content: center; }
        .action-btn.print { background: var(--accent-gold); color: var(--primary-green); }
        .action-btn.share { background: var(--secondary-green); color: var(--pure-white); }
        .action-btn.new-search { background: var(--text-subtle); color: var(--pure-white); }
        
        footer { background: var(--primary-green); color: var(--light-gold); padding: 20px; margin: 30px auto 0; border-radius: 8px; font-size: 0.9rem; font-weight: 500; text-align: center; max-width: 1000px; }

        /* --- MEDIA QUERIES (RESPONSIVITAS) --- */
        @media (max-width: 768px) {
            .navbar-mobile-toggle { display: block; }
            .navbar-menu { display: none; width: 100%; flex-direction: column; gap: 8px; margin-top: 15px; padding: 15px; background: var(--primary-green); border-radius: 8px; }
            .navbar-menu.active { display: flex; }
            .nav-divider { display: none; }
            .input-group { flex-direction: column; }
            .header h1 { font-size: 2em; }
            .search-section, .section { padding: 20px; }
            
            .info-table td { padding: 12px 15px; }
            .info-label-cell { width: 120px; font-size: 0.85em; }
            .info-value-cell { text-align: left; } /* Pastikan RATA KIRI di mobile */
            
            .score-aspek { width: 150px; font-size: 0.9em;}
            .score-nilai { text-align: right; } /* SKOR BABAK: RATA KANAN di mobile */
            
            .action-buttons { flex-direction: column; padding: 0 20px 20px; }
        }
    </style>
</head>
<body>
    <nav class="mtq-navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-logo">
                <img src="https://i.imghippo.com/files/ZnpG6770LpA.png" alt="Logo MTQ Bantul">
                MTQ Bantul 2025
            </a>

            <button class="navbar-mobile-toggle" id="mobile-toggle">
                <i class="fas fa-bars"></i>
            </button>

            <ul class="navbar-menu" id="navbar-menu">
                <li class="nav-divider">â€¢</li>
                <li class="nav-item">
                    <a href="cek-nilai.html" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Nilai</span>
                    </a>
                </li>
                <li class="nav-divider">â€¢</li>
                <li class="nav-item">
                    <a href="cek-no-urut.html" class="nav-link">
                        <i class="fas fa-list-ol"></i>
                        <span>No. Urut</span>
                    </a>
                </li>
                <li class="nav-divider">â€¢</li>
                <li class="nav-item">
                    <a href="login.html" class="nav-link">
                        <i class="fas fa-user-shield"></i>
                        <span>Admin</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-trophy"></i> Cek Nilai MTQ Bantul 2025</h1>
            <p>Sistem Penilaian Musabaqah Tilawatil Qur'an Kabupaten Bantul</p>
        </div>

        <div class="search-section">
            <div class="input-group">
                <input 
                    type="text" 
                    id="participantId" 
                    placeholder="Masukkan nomor peserta (Contoh: MTQ-1, LCP-1, dll)"
                    onkeypress="handleKeyPress(event)"
                >
                <button onclick="searchParticipant()" id="searchBtn">
                    <i class="fas fa-search"></i> Cek Nilai
                </button>
            </div>
            
            <div class="examples">
                <div class="example-chip" onclick="setExample('MTQ-1')">MTQ-1</div>
                <div class="example-chip" onclick="setExample('MTtQ-1')">MTtQ-1</div>
                <div class="example-chip" onclick="setExample('MHQ-1')">MHQ-1</div>
                <div class="example-chip" onclick="setExample('MAz-1')">MAz-1</div>
                <div class="example-chip" onclick="setExample('MPS-1')">MPS-1</div>
                <div class="example-chip" onclick="setExample('LPP-1')">LPP-1</div>
                <div class="example-chip" onclick="setExample('LCP-1')">LCP-1</div>
                <div class="example-chip" onclick="setExample('LMI-1')">LMI-1</div>
            </div>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Mencari data peserta...</p>
        </div>

        <div class="result-section" id="resultSection" style="display: none;">
            </div>
    </div>

    <footer>
        MTQ Pelajar SD Tingkat Kabupaten Bantul Tahun 2025 - Sistem Cek Nilai
    </footer>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwJ-0hT5xFwWBvOwMvBIBJ_M-nsBpbqpm5ohXL4j_67SbGvtVVe5O7iUrVMTKOl0uMw/exec';
        let currentParticipantData = null;

        // Mobile menu toggle
        document.getElementById('mobile-toggle').addEventListener('click', function() {
            document.getElementById('navbar-menu').classList.toggle('active');
        });

        // Set example and search
        function setExample(participantId) {
            document.getElementById('participantId').value = participantId;
            searchParticipant();
        }

        // Handle Enter key
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                searchParticipant();
            }
        }

        function validateParticipantId(participantId) {
            const validPrefixes = ['MTQ-', 'MTTQ-', 'MHQ-', 'MAZ-', 'MPS-', 'LPP-', 'LCP-', 'LMI-'];
            const upperCaseId = participantId.toUpperCase();
            return validPrefixes.some(prefix => upperCaseId.startsWith(prefix));
        }

        async function searchParticipant() {
            const participantId = document.getElementById('participantId').value.trim();
            const searchBtn = document.getElementById('searchBtn');
            const loading = document.getElementById('loading');
            const resultSection = document.getElementById('resultSection');

            if (!participantId) {
                showError('Masukkan nomor peserta terlebih dahulu');
                return;
            }

            let tempId = participantId.toUpperCase();

            if (!validateParticipantId(tempId)) {
                showError('Format nomor peserta tidak valid. Gunakan contoh: MTQ-1, LCP-1, dll.');
                return;
            }

            let normalizedId = tempId
                .replace('MTTQ-', 'MTtQ-')
                .replace('MAZ-', 'MAz-');
            
            resultSection.style.display = 'none';
            loading.style.display = 'block';
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mencari...';

            try {
                const response = await fetch(`${API_URL}?id=${encodeURIComponent(normalizedId)}`);
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();

                if (data.success) {
                    currentParticipantData = data;
                    displayParticipantData(data);
                } else {
                    showError(data.error || 'Peserta tidak ditemukan. Pastikan nomor peserta sudah benar.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Terjadi kesalahan. Periksa koneksi internet dan coba lagi.');
            } finally {
                loading.style.display = 'none';
                searchBtn.disabled = false;
                searchBtn.innerHTML = '<i class="fas fa-search"></i> Cek Nilai';
            }
        }

        function displayParticipantData(data) {
            const resultSection = document.getElementById('resultSection');
            let html = '';

            if (data.lomba.kode === 'LCP') {
                html = generateLCPLayout(data);
            } else {
                html = generateIndividualLayout(data);
            }

            html += `
                <div class="action-buttons">
                    <button class="action-btn print" onclick="printResults()">
                        <i class="fas fa-print"></i> Cetak Hasil
                    </button>
                    <button class="action-btn share" onclick="shareResults()">
                        <i class="fas fa-share-alt"></i> Bagikan
                    </button>
                    <button class="action-btn new-search" onclick="newSearch()">
                        <i class="fas fa-search"></i> Pencarian Baru
                    </button>
                </div>
            `;

            resultSection.innerHTML = html;
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function generateLCPLayout(data) {
            const participant = data.participant;
            const scores = data.scores;
            const teamMembers = data.teamMembers || [];

            const nilaiPenyisihan = scores.find(s => s.aspek === 'Nilai Penyisihan');
            const rankingPenyisihan = scores.find(s => s.aspek === 'Ranking Penyisihan');
            const status = scores.find(s => s.aspek === 'Status');
            const isLolos = status && (status.statusText === 'LOLOS' || status.statusText === 'Lolos');
            
            const wajibTiming = scores.find(s => s.aspek === 'Babak Wajib Timing');
            const wajibLempar = scores.find(s => s.aspek === 'Babak Wajib Lempar');
            const rebutan = scores.find(s => s.aspek === 'Babak Rebutan');
            const nilaiFinal = scores.find(s => s.aspek === 'Nilai Final');
            const juara = scores.find(s => s.aspek === 'Juara');

            let html = `
                <div class="section">
                    <h3 class="section-title"><i class="fas fa-users"></i> INFORMASI TIM</h3>
                    <table class="info-table">
                        <tbody>
                            <tr>
                                <td class="info-label-cell">No. Peserta</td>
                                <td class="info-value-cell">${participant['No Peserta']}</td>
                            </tr>
                            <tr>
                                <td class="info-label-cell">Kapanewon</td>
                                <td class="info-value-cell">${participant.Kapanewon}</td>
                            </tr>
                            <tr>
                                <td class="info-label-cell">Cabang Lomba</td>
                                <td class="info-value-cell">${data.lomba.nama}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;

            if (teamMembers.length > 0) {
                html += `
                    <div class="section">
                        <h3 class="section-title"><i class="fas fa-user-friends"></i> ANGGOTA TIM</h3>
                        <div class="table-responsive">
                            <table class="score-table">
                                <thead>
                                    <tr>
                                        <th style="width: 50px; text-align: center;">No</th>
                                        <th style="text-align: left;">Nama</th>
                                        <th style="text-align: left;">Jenis Kelamin</th>
                                        <th style="text-align: left;">Asal Sekolah</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${teamMembers.map((member, index) => `
                                        <tr>
                                            <td style="text-align: center;">${index + 1}</td>
                                            <td class="criteria-col" style="text-align: left;">${member.Nama}</td>
                                            <td style="text-align: left;">${member['Jenis Kelamin']}</td>
                                            <td style="text-align: left;">${member['Asal Sekolah']}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            html += `
                <div class="section">
                    <h3 class="section-title"><i class="fas fa-list-ol"></i> BABAK PENYISIHAN</h3>
                    <div class="scores-list">
                        <div class="score-item">
                            <span class="score-aspek">Nilai Penyisihan</span>
                            <span class="score-nilai">${nilaiPenyisihan ? nilaiPenyisihan.nilai : '-'}</span>
                        </div>
                        <div class="score-item">
                            <span class="score-aspek">Ranking Penyisihan</span>
                            <span class="score-nilai">${rankingPenyisihan ? rankingPenyisihan.nilai : '-'}</span>
                        </div>
                        <div class="score-item">
                            <span class="score-aspek">Status</span>
                            <span class="score-nilai ${isLolos ? 'highlight' : ''}">${status ? (status.statusText || 'TIDAK LOLOS') : 'TIDAK LOLOS'}</span>
                        </div>
                    </div>
                </div>
            `;

            if (isLolos) {
                html += `
                    <div class="section">
                        <div class="status-lolos">
                            <i class="fas fa-check-circle"></i> SELAMAT! Tim Anda LULUS ke Babak Final
                        </div>
                        
                        <h3 class="section-title"><i class="fas fa-trophy"></i> BABAK FINAL</h3>
                        <div class="scores-list">
                            ${wajibTiming ? `<div class="score-item"><span class="score-aspek">Babak Wajib Timing</span><span class="score-nilai">${wajibTiming.nilai}</span></div>` : ''}
                            ${wajibLempar ? `<div class="score-item"><span class="score-aspek">Babak Wajib Lempar</span><span class="score-nilai">${wajibLempar.nilai}</span></div>` : ''}
                            ${rebutan ? `<div class="score-item"><span class="score-aspek">Babak Rebutan</span><span class="score-nilai">${rebutan.nilai}</span></div>` : ''}
                            ${nilaiFinal ? `<div class="score-item"><span class="score-aspek">Nilai Final</span><span class="score-nilai highlight">${nilaiFinal.nilai}</span></div>` : ''}
                        </div>
                    </div>
                `;

                if (juara && juara.nilai > 0) {
                    const rankingLabel = getRankingLabel(juara.nilai, data.lomba.nama);
                    html += `<div class="section"><div class="juara-badge"><i class="fas fa-trophy"></i> ${rankingLabel}</div></div>`;
                }
            } else {
                html += `<div class="section"><div class="status-tidak-lolos"><i class="fas fa-info-circle"></i> Terima kasih atas partisipasinya. Tim Anda belum berhasil melanjutkan ke babak final.</div></div>`;
            }

            return html;
        }

        function generateIndividualLayout(data) {
            const participant = data.participant;
            const scores = data.scores;

            let html = `
                <div class="section">
                    <h3 class="section-title"><i class="fas fa-user"></i> INFORMASI PESERTA</h3>
                    <table class="info-table">
                        <tbody>
                            <tr>
                                <td class="info-label-cell">No. Peserta</td>
                                <td class="info-value-cell">${participant['No Peserta']}</td>
                            </tr>
                            <tr>
                                <td class="info-label-cell">Nama</td>
                                <td class="info-value-cell">${participant.Nama}</td>
                            </tr>
                            <tr>
                                <td class="info-label-cell">Jenis Kelamin</td>
                                <td class="info-value-cell">${participant['Jenis Kelamin']}</td>
                            </tr>
                            <tr>
                                <td class="info-label-cell">Asal Sekolah</td>
                                <td class="info-value-cell">${participant['Asal Sekolah']}</td>
                            </tr>
                            <tr>
                                <td class="info-label-cell">Kapanewon</td>
                                <td class="info-value-cell">${participant.Kapanewon}</td>
                            </tr>
                            <tr>
                                <td class="info-label-cell">Cabang Lomba</td>
                                <td class="info-value-cell">${data.lomba.nama}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;

            const juriScores = scores.filter(s => s.aspek.includes('Juri') && !s.aspek.includes('Jumlah'));
            const jumlahScores = scores.filter(s => s.aspek.includes('Jumlah'));
            const nilaiAkhir = scores.find(s => s.aspek === 'Nilai Akhir');
            const peringkat = scores.find(s => s.aspek === 'Peringkat');

            const criteriaMap = {};
            juriScores.forEach(score => {
                const match = score.aspek.match(/Juri (\d+) - (.+)/);
                if (match) {
                    const [, juriNum, criteria] = match;
                    if (!criteriaMap[criteria]) {
                        criteriaMap[criteria] = { j1: '-', j2: '-', j3: '-' };
                    }
                    criteriaMap[criteria][`j${juriNum}`] = score.nilai;
                }
            });

            const criteriaList = Object.keys(criteriaMap);

            if (criteriaList.length > 0) {
                html += `
                    <div class="section">
                        <h3 class="section-title"><i class="fas fa-chart-bar"></i> DETAIL PENILAIAN</h3>
                        <div class="table-responsive">
                            <table class="score-table">
                                <thead>
                                    <tr>
                                        <th>KRITERIA</th>
                                        <th>JURI 1</th>
                                        <th>JURI 2</th>
                                        <th>JURI 3</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${criteriaList.map((criteria, index) => `
                                        <tr>
                                            <td class="criteria-col">${String.fromCharCode(65 + index)}. ${criteria}</td>
                                            <td class="juri-col">${criteriaMap[criteria].j1}</td>
                                            <td class="juri-col">${criteriaMap[criteria].j2}</td>
                                            <td class="juri-col">${criteriaMap[criteria].j3}</td>
                                        </tr>
                                    `).join('')}
                                    <tr class="total-row">
                                        <td class="criteria-col"><strong>JUMLAH</strong></td>
                                        <td class="juri-col"><strong>${jumlahScores[0]?.nilai || '-'}</strong></td>
                                        <td class="juri-col"><strong>${jumlahScores[1]?.nilai || '-'}</strong></td>
                                        <td class="juri-col"><strong>${jumlahScores[2]?.nilai || '-'}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="table-responsive">
                            <table class="score-table" style="margin-top: 20px; box-shadow: none;">
                                <tbody>
                                    ${nilaiAkhir ? `<tr class="final-row">
                                        <td class="criteria-col" style="width: 50%; text-align: center !important;"><strong>NILAI AKHIR</strong></td>
                                        <td class="juri-col" style="width: 50%; text-align: center !important;"><strong>${nilaiAkhir.nilai}</strong></td>
                                    </tr>` : ''}
                                    ${peringkat ? `<tr class="final-row">
                                        <td class="criteria-col" style="text-align: center !important;"><strong>HASIL</strong></td>
                                        <td class="juri-col" style="text-align: center !important;"><strong>${getRankingLabel(peringkat.nilai, data.lomba.nama)}</strong></td>
                                    </tr>` : ''}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            return html;
        }

        function getRankingLabel(ranking, lombaName) {
            if (!ranking || ranking === 0) return '-';
            
            switch(parseInt(ranking)) {
                case 1: return `JUARA I ${getMedalEmoji(1)}`;
                case 2: return `JUARA II ${getMedalEmoji(2)}`;
                case 3: return `JUARA III ${getMedalEmoji(3)}`;
                case 4: return 'JUARA HARAPAN I';
                case 5: return 'JUARA HARAPAN II';
                default: return `PERINGKAT ${ranking}`;
            }
        }

        function getMedalEmoji(rank) {
            switch(rank) {
                case 1: return 'ðŸ¥‡';
                case 2: return 'ðŸ¥ˆ';
                case 3: return 'ðŸ¥‰';
                default: return '';
            }
        }

        function showError(message) {
            const resultSection = document.getElementById('resultSection');
            resultSection.innerHTML = `
                <div class="section">
                    <div class="error">
                        <strong><i class="fas fa-exclamation-triangle"></i> Error</strong>
                        <p>${message}</p>
                        <button onclick="newSearch()" style="margin-top: 10px; padding: 12px 20px; background: var(--accent-gold); color: var(--primary-green); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-search"></i> Pencarian Baru
                        </button>
                    </div>
                </div>
            `;
            resultSection.style.display = 'block';
        }

        function printResults() {
            window.print();
        }

        function shareResults() {
            if (navigator.share && currentParticipantData) {
                navigator.share({
                    title: `Hasil Nilai MTQ Bantul 2025 - ${currentParticipantData.participant['No Peserta']}`,
                    text: `Lihat hasil nilai ${currentParticipantData.participant.Nama || 'peserta'} di MTQ Bantul 2025`,
                    url: window.location.href
                });
            } else if (currentParticipantData) {
                const participantId = currentParticipantData.participant['No Peserta'];
                navigator.clipboard.writeText(`${window.location.href}?id=${participantId}`);
                alert('Link hasil telah disalin ke clipboard!');
            }
        }

        function newSearch() {
            document.getElementById('participantId').value = '';
            document.getElementById('participantId').focus();
            document.getElementById('resultSection').style.display = 'none';
            currentParticipantData = null;
        }

        document.getElementById('participantId').focus();

        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const participantId = urlParams.get('id');
            if (participantId) {
                document.getElementById('participantId').value = participantId;
                searchParticipant();
            }
        });
    </script>
</body>
</html>
